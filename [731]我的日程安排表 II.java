import java.util.HashMap;
import java.util.Map;

/**
<p>å®ç°ä¸€ä¸ª <code>MyCalendar</code> ç±»æ¥å­˜æ”¾ä½ çš„æ—¥ç¨‹å®‰æ’ã€‚å¦‚æœè¦æ·»åŠ çš„æ—¶é—´å†…ä¸ä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢æ—¶ï¼Œåˆ™å¯ä»¥å­˜å‚¨è¿™ä¸ªæ–°çš„æ—¥ç¨‹å®‰æ’ã€‚</p>

<p><code>MyCalendar</code> æœ‰ä¸€ä¸ª <code>book(int start, int end)</code>æ–¹æ³•ã€‚å®ƒæ„å‘³ç€åœ¨ <code>start</code> åˆ° <code>end</code> æ—¶é—´å†…å¢åŠ ä¸€ä¸ªæ—¥ç¨‹å®‰æ’ï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„æ—¶é—´æ˜¯åŠå¼€åŒºé—´ï¼Œå³ <code>[start, end)</code>, å®æ•°&nbsp;<code>x</code> çš„èŒƒå›´ä¸ºï¼Œ &nbsp;<code>start &lt;= x &lt; end</code>ã€‚</p>

<p>å½“ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’æœ‰ä¸€äº›æ—¶é—´ä¸Šçš„äº¤å‰æ—¶ï¼ˆä¾‹å¦‚ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’éƒ½åœ¨åŒä¸€æ—¶é—´å†…ï¼‰ï¼Œå°±ä¼šäº§ç”Ÿä¸‰é‡é¢„è®¢ã€‚</p>

<p>æ¯æ¬¡è°ƒç”¨ <code>MyCalendar.book</code>æ–¹æ³•æ—¶ï¼Œå¦‚æœå¯ä»¥å°†æ—¥ç¨‹å®‰æ’æˆåŠŸæ·»åŠ åˆ°æ—¥å†ä¸­è€Œä¸ä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢ï¼Œè¿”å› <code>true</code>ã€‚å¦åˆ™ï¼Œè¿”å› <code>false</code> å¹¶ä¸”ä¸è¦å°†è¯¥æ—¥ç¨‹å®‰æ’æ·»åŠ åˆ°æ—¥å†ä¸­ã€‚</p>

<p>è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è°ƒç”¨<code>MyCalendar</code> ç±»: <code>MyCalendar cal = new MyCalendar();</code> <code>MyCalendar.book(start, end)</code></p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>MyCalendar();
MyCalendar.book(10, 20); // returns true
MyCalendar.book(50, 60); // returns true
MyCalendar.book(10, 40); // returns true
MyCalendar.book(5, 15); // returns false
MyCalendar.book(5, 10); // returns true
MyCalendar.book(25, 55); // returns true
<strong>è§£é‡Šï¼š</strong> 
å‰ä¸¤ä¸ªæ—¥ç¨‹å®‰æ’å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ã€‚ ç¬¬ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’ä¼šå¯¼è‡´åŒé‡é¢„è®¢ï¼Œä½†å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ã€‚
ç¬¬å››ä¸ªæ—¥ç¨‹å®‰æ’æ´»åŠ¨ï¼ˆ5,15ï¼‰ä¸èƒ½æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ä¸‰é‡é¢„è®¢ã€‚
ç¬¬äº”ä¸ªæ—¥ç¨‹å®‰æ’ï¼ˆ5,10ï¼‰å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºå®ƒæœªä½¿ç”¨å·²ç»åŒé‡é¢„è®¢çš„æ—¶é—´10ã€‚
ç¬¬å…­ä¸ªæ—¥ç¨‹å®‰æ’ï¼ˆ25,55ï¼‰å¯ä»¥æ·»åŠ è‡³æ—¥å†ä¸­ï¼Œå› ä¸ºæ—¶é—´ [25,40] å°†å’Œç¬¬ä¸‰ä¸ªæ—¥ç¨‹å®‰æ’åŒé‡é¢„è®¢ï¼›
æ—¶é—´ [40,50] å°†å•ç‹¬é¢„è®¢ï¼Œæ—¶é—´ [50,55ï¼‰å°†å’Œç¬¬äºŒä¸ªæ—¥ç¨‹å®‰æ’åŒé‡é¢„è®¢ã€‚
</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li>æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè°ƒç”¨&nbsp;<code>MyCalendar.book</code>&nbsp;å‡½æ•°æœ€å¤šä¸è¶…è¿‡&nbsp;<code>1000</code>æ¬¡ã€‚</li>
	<li>è°ƒç”¨å‡½æ•°&nbsp;<code>MyCalendar.book(start, end)</code>æ—¶ï¼Œ&nbsp;<code>start</code> å’Œ&nbsp;<code>end</code> çš„å–å€¼èŒƒå›´ä¸º&nbsp;<code>[0, 10^9]</code>ã€‚</li>
</ul>
<div><div>Related Topics</div><div><li>è®¾è®¡</li><li>çº¿æ®µæ ‘</li><li>äºŒåˆ†æŸ¥æ‰¾</li><li>æœ‰åºé›†åˆ</li></div></div><br><div><li>ğŸ‘ 140</li><li>ğŸ‘ 0</li></div>
*/

//leetcode submit region begin(Prohibit modification and deletion)
class MyCalendarTwo {
    Map<Integer, int[]> tree;

    public MyCalendarTwo() {
        tree = new HashMap<Integer, int[]>();
    }

    public boolean book(int start, int end) {
        update(start, end - 1, 1, 0, 1000000000, 1);
        tree.putIfAbsent(1, new int[2]);
        if (tree.get(1)[0] > 2) {
            update(start, end - 1, -1, 0, 1000000000, 1);
            return false;
        }
        return true;
    }

    public void update(int start, int end, int val, int l, int r, int idx) {
        if (r < start || end < l) {
            return;
        }
        tree.putIfAbsent(idx, new int[2]);
        if (start <= l && r <= end) {
            tree.get(idx)[0] += val;
            tree.get(idx)[1] += val;
        } else {
            int mid = (l + r) >> 1;
            update(start, end, val, l, mid, 2 * idx);
            update(start, end, val, mid + 1, r, 2 * idx + 1);
            tree.putIfAbsent(2 * idx, new int[2]);
            tree.putIfAbsent(2 * idx + 1, new int[2]);
            tree.get(idx)[0] = tree.get(idx)[1] + Math.max(tree.get(2 * idx)[0], tree.get(2 * idx + 1)[0]);
        }
    }
}

/**
 * Your MyCalendarTwo object will be instantiated and called as such:
 * MyCalendarTwo obj = new MyCalendarTwo();
 * boolean param_1 = obj.book(start,end);
 */
//leetcode submit region end(Prohibit modification and deletion)
